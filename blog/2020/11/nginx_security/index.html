<!DOCTYPE html>
<html lang="zh-cn"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <link rel="icon shortcut" href="/favicon.ico" sizes="32x32" />
<link rel="icon" href="/favicon.png" type="image/png" />
<link rel="icon" href="/favicon-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)" />
<link rel="icon" href="/favicon-16x16.png" type="image/png" sizes="16x16" />
<link rel="icon" href="/favicon-32x32.png" type="image/png" sizes="32x32" />
<link rel="apple-touch-icon" href="/favicon-180x180.png" type="image/png" sizes="180x180" />
<link fetchpriority="low" href="/site.webmanifest" rel="manifest" />

  <title>Nginx服务器安全加固 – 保罗札记</title>
  <meta name="description" content="基础知识 常用配置 顶部配置
#定义 Nginx 运行的用户和用户组 user nginx; #进程文件 pid /var/run/nginx.pid; #错误日志位置和级别，debug、info、notice、warn、error、crit error_log /var/log/nginx/error.log warn; #Nginx worker 的进程数，一般可设置为可用的CPU内核数。 worker_processes 8; #每个 worker 打开文件描述符的最大数量限制。理论值应该是最多打开文件数（系统的值ulimit -n） #与 nginx 进程数相除，但是 nginx 分配请求并不均匀，所以建议与ulimit …" />

  
    <link rel="canonical" href="http://localhost:1313/blog/2020/11/nginx_security/" itemprop="url" />
  

  

<meta property="og:title" content="Nginx服务器安全加固" />
<meta property="og:description" content="基础知识
    常用配置
    顶部配置

  

#定义 Nginx 运行的用户和用户组
user nginx;
 
#进程文件
pid /var/run/nginx.pid;
 
#错误日志位置和级别，debug、info、notice、warn、error、crit
error_log  /var/log/nginx/error.log warn;
 
#Nginx worker 的进程数，一般可设置为可用的CPU内核数。
worker_processes 8;
 
#每个 worker 打开文件描述符的最大数量限制。理论值应该是最多打开文件数（系统的值ulimit -n）
#与 nginx 进程数相除，但是 nginx 分配请求并不均匀，所以建议与ulimit -n的值保持一致。
worker_rlimit_nofile 65535;
  
    
    
  


  

Events 模块" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/blog/2020/11/nginx_security/" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2020-11-22T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-11-30T18:58:28+08:00" />

  
  <meta itemprop="name" content="Nginx服务器安全加固">
  <meta itemprop="description" content="基础知识 常用配置 顶部配置
#定义 Nginx 运行的用户和用户组 user nginx; #进程文件 pid /var/run/nginx.pid; #错误日志位置和级别，debug、info、notice、warn、error、crit error_log /var/log/nginx/error.log warn; #Nginx worker 的进程数，一般可设置为可用的CPU内核数。 worker_processes 8; #每个 worker 打开文件描述符的最大数量限制。理论值应该是最多打开文件数（系统的值ulimit -n） #与 nginx 进程数相除，但是 nginx 分配请求并不均匀，所以建议与ulimit -n的值保持一致。 worker_rlimit_nofile 65535; Events 模块">
  <meta itemprop="datePublished" content="2020-11-22T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-11-30T18:58:28+08:00">
  <meta itemprop="wordCount" content="7132">
  <meta itemprop="keywords" content="Nginx,Security">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Nginx服务器安全加固">
  <meta name="twitter:description" content="基础知识 常用配置 顶部配置
#定义 Nginx 运行的用户和用户组 user nginx; #进程文件 pid /var/run/nginx.pid; #错误日志位置和级别，debug、info、notice、warn、error、crit error_log /var/log/nginx/error.log warn; #Nginx worker 的进程数，一般可设置为可用的CPU内核数。 worker_processes 8; #每个 worker 打开文件描述符的最大数量限制。理论值应该是最多打开文件数（系统的值ulimit -n） #与 nginx 进程数相除，但是 nginx 分配请求并不均匀，所以建议与ulimit -n的值保持一致。 worker_rlimit_nofile 65535; Events 模块">

    <link href="/css/compiled/main.css" rel="stylesheet" />



  <link href="/css/custom.css" rel="stylesheet" />





  <script>
     
    const defaultTheme = 'system';

    const setDarkTheme = () => {
      document.documentElement.classList.add("dark");
      document.documentElement.style.colorScheme = "dark";
    }
    const setLightTheme = () => {
      document.documentElement.classList.remove("dark");
      document.documentElement.style.colorScheme = "light";
    }

    if ("color-theme" in localStorage) {
      localStorage.getItem("color-theme") === "dark" ? setDarkTheme() : setLightTheme();
    } else {
      defaultTheme === "dark" ? setDarkTheme() : setLightTheme();
      if (defaultTheme === "system") {
        window.matchMedia("(prefers-color-scheme: dark)").matches ? setDarkTheme() : setLightTheme();
      }
    }
  </script>

  
</head>
<body dir="ltr"><div class="nav-container hx-sticky hx-top-0 hx-z-20 hx-w-full hx-bg-transparent print:hx-hidden">
  <div class="nav-container-blur hx-pointer-events-none hx-absolute hx-z-[-1] hx-h-full hx-w-full hx-bg-white dark:hx-bg-dark hx-shadow-[0_2px_4px_rgba(0,0,0,.02),0_1px_0_rgba(0,0,0,.06)] contrast-more:hx-shadow-[0_0_0_1px_#000] dark:hx-shadow-[0_-1px_0_rgba(255,255,255,.1)_inset] contrast-more:dark:hx-shadow-[0_0_0_1px_#fff]"></div>

  <nav class="hx-mx-auto hx-flex hx-items-center hx-justify-end hx-gap-2 hx-h-16 hx-px-6 hx-max-w-[90rem]">
    <a class="hx-flex hx-items-center hover:hx-opacity-75 ltr:hx-mr-auto rtl:hx-ml-auto" href="/">
        <img class="hx-block dark:hx-hidden" src="/logos/logo.png" alt="保罗札记" height="46" width="220" />
        <img class="hx-hidden dark:hx-block" src="/logos/logo.png" alt="保罗札记" height="46" width="220" />
    </a><a
            title="首页"
            href="/"
            
            class="hx-text-sm contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block hx-text-gray-600 hover:hx-text-gray-800 dark:hx-text-gray-400 dark:hover:hx-text-gray-200"
          >
            <span class="hx-text-center">首页</span>
          </a><a
            title="技术博客"
            href="/blog"
            
            class="hx-text-sm contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block hx-font-medium"
          >
            <span class="hx-text-center">技术博客</span>
          </a><a
            title="关于我"
            href="/about"
            
            class="hx-text-sm contrast-more:hx-text-gray-700 contrast-more:dark:hx-text-gray-100 hx-relative -hx-ml-2 hx-hidden hx-whitespace-nowrap hx-p-2 md:hx-inline-block hx-text-gray-600 hover:hx-text-gray-800 dark:hx-text-gray-400 dark:hover:hx-text-gray-200"
          >
            <span class="hx-text-center">关于我</span>
          </a><div class="search-wrapper hx-relative md:hx-w-64">
  <div class="hx-relative hx-flex hx-items-center hx-text-gray-900 contrast-more:hx-text-gray-800 dark:hx-text-gray-300 contrast-more:dark:hx-text-gray-300">
    <input
      placeholder="搜索文档..."
      class="search-input hx-block hx-w-full hx-appearance-none hx-rounded-lg hx-px-3 hx-py-2 hx-transition-colors hx-text-base hx-leading-tight md:hx-text-sm hx-bg-black/[.05] dark:hx-bg-gray-50/10 focus:hx-bg-white dark:focus:hx-bg-dark placeholder:hx-text-gray-500 dark:placeholder:hx-text-gray-400 contrast-more:hx-border contrast-more:hx-border-current"
      type="search"
      value=""
      spellcheck="false"
    />
    <kbd
      class="hx-absolute hx-my-1.5 hx-select-none ltr:hx-right-1.5 rtl:hx-left-1.5 hx-h-5 hx-rounded hx-bg-white hx-px-1.5 hx-font-mono hx-text-[10px] hx-font-medium hx-text-gray-500 hx-border dark:hx-border-gray-100/20 dark:hx-bg-dark/50 contrast-more:hx-border-current contrast-more:hx-text-current contrast-more:dark:hx-border-current hx-items-center hx-gap-1 hx-transition-opacity hx-pointer-events-none hx-hidden sm:hx-flex"
    >
      CTRL K
    </kbd>
  </div>

  <div>
    <ul
      class="search-results hextra-scrollbar hx-hidden hx-border hx-border-gray-200 hx-bg-white hx-text-gray-100 dark:hx-border-neutral-800 dark:hx-bg-neutral-900 hx-absolute hx-top-full hx-z-20 hx-mt-2 hx-overflow-auto hx-overscroll-contain hx-rounded-xl hx-py-2.5 hx-shadow-xl hx-max-h-[min(calc(50vh-11rem-env(safe-area-inset-bottom)),400px)] md:hx-max-h-[min(calc(100vh-5rem-env(safe-area-inset-bottom)),400px)] hx-inset-x-0 ltr:md:hx-left-auto rtl:md:hx-right-auto contrast-more:hx-border contrast-more:hx-border-gray-900 contrast-more:dark:hx-border-gray-50 hx-w-screen hx-min-h-[100px] hx-max-w-[min(calc(100vw-2rem),calc(100%+20rem))]"
      style="transition: max-height 0.2s ease 0s;"
    ></ul>
  </div>
</div>
<button type="button" aria-label="Menu" class="hamburger-menu -hx-mr-2 hx-rounded hx-p-2 active:hx-bg-gray-400/20 md:hx-hidden"><svg height=24 fill="none" viewBox="0 0 24 24" stroke="currentColor"><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8H20"></path></g><g><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16H20"></path></g></svg></button>
  </nav>
</div>

  <div class="hx-mx-auto hx-flex hx-max-w-screen-xl">
    
    
<nav class="hextra-toc hx-order-last hx-hidden hx-w-64 hx-shrink-0 xl:hx-block print:hx-hidden hx-px-4" aria-label="table of contents">
    <div class="hextra-scrollbar hx-sticky hx-top-16 hx-overflow-y-auto hx-pr-4 hx-pt-6 hx-text-sm [hyphens:auto] hx-max-h-[calc(100vh-var(--navbar-height)-env(safe-area-inset-bottom))] ltr:hx--mr-4 rtl:hx--ml-4"><p class="hx-mb-4 hx-font-semibold hx-tracking-tight">内容目录</p><ul>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="hx-font-semibold hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86">基础知识
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%b8%b8%e7%94%a8%e9%85%8d%e7%bd%ae">常用配置
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="hx-font-semibold hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e8%ae%be%e7%bd%ae">设置
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%80%9a%e8%bf%87%e5%88%86%e5%8c%ba%e6%8c%82%e8%bd%bd%e5%85%81%e8%ae%b8%e6%9c%80%e5%b0%91%e7%89%b9%e6%9d%83">通过分区挂载允许最少特权
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%85%8d%e7%bd%aeetcsysctlconf%e5%bc%ba%e5%8c%96linux%e5%ae%89%e5%85%a8">配置/etc/sysctl.conf强化Linux安全
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e6%8e%a7%e5%88%b6%e7%bc%93%e5%86%b2%e5%8c%ba%e6%ba%a2%e5%87%ba%e6%94%bb%e5%87%bb">控制缓冲区溢出攻击
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e6%8e%a7%e5%88%b6%e5%b9%b6%e5%8f%91%e8%bf%9e%e6%8e%a5">控制并发连接
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%8f%aa%e5%85%81%e8%ae%b8%e5%9f%9f%e5%90%8d%e7%9a%84%e8%ae%bf%e9%97%ae">只允许域名的访问
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#url-%e5%8f%82%e6%95%b0%e8%bf%87%e6%bb%a4%e6%95%8f%e6%84%9f%e5%ad%97">url 参数过滤敏感字
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%99%90%e5%88%b6%e5%8f%af%e7%94%a8%e7%9a%84%e8%af%b7%e6%b1%82%e6%96%b9%e6%b3%95">限制可用的请求方法
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e6%8b%92%e7%bb%9d%e4%b8%80%e4%ba%9buser-agents">拒绝一些User-Agents
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%9b%ae%e5%bd%95%e9%99%90%e5%88%b6ip%e8%ae%bf%e9%97%ae">目录限制IP访问
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%80%9a%e8%bf%87%e5%af%86%e7%a0%81%e4%bf%9d%e6%8a%a4%e7%9b%ae%e5%bd%95">通过密码保护目录
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%a6%82%e4%bd%95%e9%98%b2%e6%ad%a2%e5%9b%be%e7%89%87%e7%9b%97%e9%93%be">如何防止图片盗链
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#nginx-ssl%e9%85%8d%e7%bd%ae">Nginx SSL配置
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e5%9c%a8%e9%98%b2%e7%81%ab%e5%a2%99%e7%ba%a7%e9%99%90%e5%88%b6%e6%af%8f%e4%b8%aaip%e7%9a%84%e8%bf%9e%e6%8e%a5%e6%95%b0">在防火墙级限制每个IP的连接数
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%85%8d%e7%bd%ae%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e4%bf%9d%e6%8a%a4web%e6%9c%8d%e5%8a%a1%e5%99%a8">配置操作系统保护Web服务器
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%99%90%e5%88%b6nginx%e8%bf%9e%e6%8e%a5%e4%bc%a0%e5%87%ba">限制Nginx连接传出
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e6%a0%b9%e6%8d%ae%e7%94%a8%e6%88%b7%e7%9a%84%e7%9c%9f%e5%ae%9e-ip-%e5%81%9a%e8%bf%9e%e6%8e%a5%e9%99%90%e5%88%b6">根据用户的真实 IP 做连接限制
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%bb%8f%e8%bf%87%e5%a4%9a%e5%b1%82cdn%e4%b9%8b%e5%90%8e%e5%8f%96%e5%be%97%e5%8e%9f%e5%a7%8b%e7%94%a8%e6%88%b7%e7%9a%84ip%e5%9c%b0%e5%9d%80">经过多层CDN之后取得原始用户的IP地址
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%9a%90%e8%97%8f%e7%89%88%e6%9c%ac%e4%bf%a1%e6%81%af">隐藏版本信息
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%a6%81%e7%94%a8%e6%89%a9%e5%b1%95%e5%90%8d">禁用扩展名
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%87%8d%e5%ae%9a%e5%90%91http%e8%af%b7%e6%b1%82%e5%88%b0https">重定向HTTP请求到HTTPS
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e9%98%b2%e6%ad%a2xss%e6%94%bb%e5%87%bb">防止XSS攻击
        </a>
      </li>
      <li class="hx-my-2 hx-scroll-my-6 hx-scroll-py-6">
        <a class="ltr:hx-pl-4 rtl:hx-pr-4 hx-inline-block hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-300 contrast-more:hx-text-gray-900 contrast-more:hx-underline contrast-more:dark:hx-text-gray-50 hx-w-full hx-break-words" href="#%e7%9b%ae%e5%bd%95%e5%8f%aa%e8%af%bb">目录只读
        </a>
      </li></ul>
      <div class="hx-mt-8 hx-border-t hx-bg-white hx-pt-8 hx-shadow-[0_-12px_16px_white] dark:hx-bg-dark dark:hx-shadow-[0_-12px_16px_#111] hx-sticky hx-bottom-0 hx-flex hx-flex-col hx-items-start hx-gap-2 hx-pb-8 dark:hx-border-neutral-800 contrast-more:hx-border-t contrast-more:hx-border-neutral-400 contrast-more:hx-shadow-none contrast-more:dark:hx-border-neutral-400"><div>
          <div class="label_post_tag hx-text-gray-500">文章分类</div>
          <div class="post_tag">
            <a class="tag_item">nginx</a></div>
        </div><div>
          <div class="label_post_tag hx-text-gray-500">标签</div>
          <div class="post_tag">
            <a class="tag_item">nginx</a>
            <a class="tag_item">security</a></div>
        </div>
        <div class="container_back_to_top">
          <button aria-hidden="true" id="backToTop" onClick="scrollUp();" class="hx-transition-all hx-duration-75 hx-opacity-0 hx-text-xs hx-font-medium hx-text-gray-500 hover:hx-text-gray-900 dark:hx-text-gray-400 dark:hover:hx-text-gray-100 contrast-more:hx-text-gray-800 contrast-more:dark:hx-text-gray-50">
            <span>返回顶部</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="hx-inline ltr:hx-ml-1 rtl:hx-mr-1 hx-h-3.5 hx-w-3.5 hx-border hx-rounded-full hx-border-gray-500 hover:hx-border-gray-900 dark:hx-border-gray-400 dark:hover:hx-border-gray-100 contrast-more:hx-border-gray-800 contrast-more:dark:hx-border-gray-50">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
            </svg>
        </button>
        </div>
      </div>
    </div>
  </nav>


    <article class="hx-w-full hx-break-words hx-flex hx-min-h-[calc(100vh-var(--navbar-height))] hx-min-w-0 hx-justify-center hx-pb-8 hx-pr-[calc(env(safe-area-inset-right)-1.5rem)]">
      <main class="hx-w-full hx-min-w-0 hx-max-w-6xl hx-px-6 hx-pt-4 md:hx-px-12">
        
  <div class="hx-mt-1.5 hx-flex hx-items-center hx-gap-1 hx-overflow-hidden hx-text-sm hx-text-gray-500 dark:hx-text-gray-400 contrast-more:hx-text-current">
        <div class="hx-whitespace-nowrap hx-transition-colors hx-min-w-[24px] hx-overflow-hidden hx-text-ellipsis hover:hx-text-gray-900 dark:hover:hx-text-gray-100">
          <a href="/blog/">技术博客</a>
        </div><svg class="hx-w-3.5 hx-shrink-0 rtl:-hx-rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg><div class="hx-whitespace-nowrap hx-transition-colors hx-font-medium hx-text-gray-700 contrast-more:hx-font-bold contrast-more:hx-text-current dark:hx-text-gray-100 contrast-more:dark:hx-text-current">Nginx服务器安全加固</div>
  </div>

        <h1 class="hx-mt-2 hx-text-4xl hx-font-bold hx-tracking-tight hx-text-slate-900 dark:hx-text-slate-100">Nginx服务器安全加固</h1>
        <div class="hx-mt-4 hx-mb-16 hx-text-gray-500 hx-text-sm hx-flex hx-items-center hx-flex-wrap hx-gap-y-2"><span class="hx-mr-1">November 22, 2020</span></div>
        <div class="content">
          <h2>基础知识<span class="hx-absolute -hx-mt-20" id="基础知识"></span>
    <a href="#%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><h3>常用配置<span class="hx-absolute -hx-mt-20" id="常用配置"></span>
    <a href="#%e5%b8%b8%e7%94%a8%e9%85%8d%e7%bd%ae" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>顶部配置</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#定义 Nginx 运行的用户和用户组</span>
</span></span><span class="line"><span class="cl">user nginx<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">#进程文件</span>
</span></span><span class="line"><span class="cl">pid /var/run/nginx.pid<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">#错误日志位置和级别，debug、info、notice、warn、error、crit</span>
</span></span><span class="line"><span class="cl">error_log  /var/log/nginx/error.log warn<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">#Nginx worker 的进程数，一般可设置为可用的CPU内核数。</span>
</span></span><span class="line"><span class="cl">worker_processes 8<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">#每个 worker 打开文件描述符的最大数量限制。理论值应该是最多打开文件数（系统的值ulimit -n）</span>
</span></span><span class="line"><span class="cl"><span class="c1">#与 nginx 进程数相除，但是 nginx 分配请求并不均匀，所以建议与ulimit -n的值保持一致。</span>
</span></span><span class="line"><span class="cl">worker_rlimit_nofile 65535<span class="p">;</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>Events 模块</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">events <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#设置一个worker进程同时打开的最大连接数</span>
</span></span><span class="line"><span class="cl">    worker_connections 2048<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#告诉nginx收到一个新连接通知后接受尽可能多的连接</span>
</span></span><span class="line"><span class="cl">    multi_accept on<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#设置用于复用客户端线程的轮询方法。如果你使用Linux 2.6+，你应该使用epoll。</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 如果你使用*BSD，你应该使用kqueue。</span>
</span></span><span class="line"><span class="cl">    use epoll<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>HTTP 模块</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">http <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#隐藏 Nginx 的版本号，提高安全性。</span>
</span></span><span class="line"><span class="cl">    server_tokens off<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#开启高效文件传输模式，sendfile 指令指定 Nginx 是否调用sendfile 函数来输出文件，</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#对于普通应用设为 on，如果用来进行下载等应用磁盘 IO 重负载应用，可设置为 off，以平</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#衡磁盘与网络 I/O 处理速度，降低系统的负载。</span>
</span></span><span class="line"><span class="cl">    sendfile on<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#是否开启目录列表访问，默认关闭。</span>
</span></span><span class="line"><span class="cl">    autoindex off<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#告诉 Nginx 在一个数据包里发送所有头文件，而不一个接一个的发送</span>
</span></span><span class="line"><span class="cl">    tcp_nopush on<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#告诉 Nginx 不要缓存数据，而是一段一段的发送--当需要及时发送数据时，就应该给应用设置</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#这个属性，这样发送一小块数据信息时就不能立即得到返回值。Nginx 默认会始终工作在 tcp </span>
</span></span><span class="line"><span class="cl">    <span class="c1">#nopush 状态下。但是当开启前面的 sendfile on; 时，它的工作特点是 nopush 的最后一</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#个包会自动转转换到 nopush off。为了减小那200ms的延迟，开启 nodelay on; 将其很快</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#传送出去。结论就是 sendfile on; 开启时，tcp_nopush 和 tcp_nodelay 都是on 是可以的。</span>
</span></span><span class="line"><span class="cl">    tcp_nodelay on<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#日志格式设定</span>
</span></span><span class="line"><span class="cl">    log_format  main  <span class="s1">&#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#定义访问日志，设置为 off 可以关闭日志，提高性能</span>
</span></span><span class="line"><span class="cl">    access_log /var/log/nginx/access.log main<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#连接超时时间，单位是秒</span>
</span></span><span class="line"><span class="cl">    keepalive_timeout 120<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#读取HTTP头部的超时时间，默认值 60。客户端与服务器建立连接后将开始接收HTTP头部，在这个过程中，</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#如果在一个时间间隔（超时时间）内没有读取到客户端发来的字节，则认为超时，并向客户端返回408 </span>
</span></span><span class="line"><span class="cl">    <span class="c1">#(&#34;Request timed out&#34;)响应。</span>
</span></span><span class="line"><span class="cl">    client_header_timeout 60<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#默认值 60。与client_header_timeout相似，只是这个超时时间只在读取HTTP包体时才有效。</span>
</span></span><span class="line"><span class="cl">    client_body_timeout 10<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#发送响应的超时时间，默认值 60。即Nginx服务器向客户端发送了数据包，但客户端一直没有去接收这个数</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#据包。如果某个连接超过send_timeout定义的超时时间，那么Nginx将会关闭这个连接。</span>
</span></span><span class="line"><span class="cl">    send_timeout 60<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#连接超时后将通过向客户端发送RST包来直接重置连接。这个选项打开后，Nginx会在某个连接超时后，不是</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#使用正常情形下的四次握手关闭TCP连接，而是直接向用户发送RST重置包，不再等待用户的应答，直接释放</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#Nginx服务器上关于这个套接字使用的所有缓存（如TCP滑动窗口）。相比正常的关闭方式，它使得服务器避</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#免产生许多处于FIN_WAIT_1、FIN_WAIT_2、TIME_WAIT状态的TCP连接。注意，使用RST重置包关闭连接</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#会带来一些问题，默认情况下不会开启。</span>
</span></span><span class="line"><span class="cl">    reset_timedout_connection off<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#要限制连接，必须先有一个容器对连接进行计数，&#34;zone=&#34; 是给它一个名字，可以随便叫，这个名字要跟下</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#面的 limit_conn 一致。$binary_remote_addr 用二进制来储存客户端的地址，1m 可以储存 32000</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#个并发会话。</span>
</span></span><span class="line"><span class="cl">    limit_conn_zone <span class="nv">$binary_remote_addr</span> <span class="nv">zone</span><span class="o">=</span>addr:5m<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#给定的key设置最大连接数。这里key是addr，我们设置的值是100，也就是说我们允许每一个IP地址最多同</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#时打开有100个连接。</span>
</span></span><span class="line"><span class="cl">    limit_conn addr 100<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#对每个连接限速100k。这如果一个IP允许两个并发连接，那么这个IP就是限速200K。</span>
</span></span><span class="line"><span class="cl">    limit_rate 100k<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#include 是一个在当前文件中包含另一个文件内容的指令。这里我们使用它来加载文件扩展名与文件类型映</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#射表。nginx根据映射关系，设置http请求响应头的Content-Type值。当在映射表找不到时，使用nginx.conf</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#中default-type指定的默认值。</span>
</span></span><span class="line"><span class="cl">    include /etc/nginx/mime.types<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#设置文件使用的默认的MIME-type</span>
</span></span><span class="line"><span class="cl">    default_type text/html<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#默认编码</span>
</span></span><span class="line"><span class="cl">    charset UTF-8<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#该模块可以读取预先压缩的gz文件，这样可以减少每次请求进行gzip压缩的CPU资源消耗。该模块启用后，</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#nginx首先检查是否存在请求静态文件的gz结尾的文件，如果有则直接返回该gz文件内容。</span>
</span></span><span class="line"><span class="cl">    gzip_static off<span class="p">;</span> 
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#开启 gzip 压缩。</span>
</span></span><span class="line"><span class="cl">    gzip on<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1"># 禁用客户端为 IE6 时的 gzip功能。</span>
</span></span><span class="line"><span class="cl">    gzip_disable <span class="s2">&#34;msie6&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#Nginx做为反向代理的时候启用。可选值：off|expired|no-cache|no-sotre|private|no_last_modified|no_etag|auth|any</span>
</span></span><span class="line"><span class="cl">    gzip_proxied any<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#设置允许压缩的页面最小字节数，页面字节数从header头中的Content-Length中进行获取。</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#建议设置成大于1k的字节数，小于1k可能会越压越大。</span>
</span></span><span class="line"><span class="cl">    gzip_min_length 1024<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#设置数据的压缩等级。这个等级可以是1-9之间的任意数值，9是最慢但是压缩比最大的。</span>
</span></span><span class="line"><span class="cl">    gzip_comp_level 5<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#设置系统获取几个单位的缓存用于存储gzip的压缩结果数据流。 例如 4 4k 代表以4k为单位，</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#按照原始数据大小以4k为单位的4倍申请内存。如果没有设置，默认值是申请跟原始数据相同大小的内存空间</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#去存储gzip压缩结果。</span>
</span></span><span class="line"><span class="cl">    gzip_buffers <span class="m">4</span> 16k<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#设置需要压缩的数据格式。Nginx默认只对text/html进行压缩。</span>
</span></span><span class="line"><span class="cl">    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#为打开文件指定缓存，默认是没有启用的，max 指定缓存数量，建议和打开文件数一致，inactive</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#是指经过多长时间文件没被请求后删除缓存。</span>
</span></span><span class="line"><span class="cl">    open_file_cache <span class="nv">max</span><span class="o">=</span><span class="m">65535</span> <span class="nv">inactive</span><span class="o">=</span>30s<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#多长时间检查一次缓存的有效信息</span>
</span></span><span class="line"><span class="cl">    open_file_cache_valid 30s<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#open_file_cache指令中的inactive参数时间内文件的最少使用次数，如果超过这个数字，文件描述符一</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#直是在缓存中打开的。出现 Last-Modified 不变的情况，就是因为当nginx对一个静态文件缓存后，如果</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#30s内还在访问它，那么它的缓存就一直存在，直到30s内你不访问了为止。</span>
</span></span><span class="line"><span class="cl">    open_file_cache_min_uses 2<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#是否记录cache错误</span>
</span></span><span class="line"><span class="cl">    open_file_cache_errors on<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    include /etc/nginx/conf.d/*.conf<span class="p">;</span>
</span></span><span class="line"><span class="cl">    include /etc/nginx/sites-enabled/*<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>SERVER 模块</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">server <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#监听端口，nginx 会根据请求的 HOST 来决定使用哪个 SERVER 段的配置。如果没有匹配的 server_name，</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#则默认使用配置文件中第一个。加上 default_server 则可以以指定没有匹配时的默认规则。</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#listen 80;</span>
</span></span><span class="line"><span class="cl">    listen <span class="m">80</span> default_server<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#域名可以有多个，用空格隔开</span>
</span></span><span class="line"><span class="cl">    server_name www.test.com test.com<span class="p">;</span>
</span></span><span class="line"><span class="cl">    root /user/share/nginx/html/test<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#404页面配置</span>
</span></span><span class="line"><span class="cl">    error_page   <span class="m">404</span>   /404.html<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#配置 ssl，有需要时开启。</span>
</span></span><span class="line"><span class="cl">    ssl on<span class="p">;</span>
</span></span><span class="line"><span class="cl">    ssl_certificate /etc/nginx/ssl/server.crt<span class="p">;</span>
</span></span><span class="line"><span class="cl">    ssl_certificate_key /etc/nginx/ssl/server.key<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    location / <span class="o">{</span>
</span></span><span class="line"><span class="cl">        index   index.html index.php<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#图片缓存时间设置</span>
</span></span><span class="line"><span class="cl">    location ~ .*.<span class="o">(</span>gif<span class="p">|</span>jpg<span class="p">|</span>jpeg<span class="p">|</span>png<span class="p">|</span>bmp<span class="p">|</span>swf<span class="o">)</span>$ <span class="o">{</span>
</span></span><span class="line"><span class="cl">        expires 10d<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1">#JS和CSS缓存时间设置</span>
</span></span><span class="line"><span class="cl">    location ~ .*.<span class="o">(</span>js<span class="p">|</span>css<span class="o">)</span>?$ <span class="o">{</span>
</span></span><span class="line"><span class="cl">        expires 1h<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    location ~ <span class="o">[</span>^/<span class="o">]</span><span class="se">\.</span>php<span class="o">(</span>/<span class="p">|</span>$<span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        fastcgi_index   index.php<span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#开启 PATH_INFO 支持，作用就是把参数按照给定的正则表达式分割成 $fastcgi_script_name 和 $fastcgi_path_info。</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#例如：请求 index.php/id/1 不加此行配置时，fastcgi_script_name 是 /index.php/id/1，fastcgi_path_info 是空。</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#加上之后，fastcgi_script_name 是 index.php，fastcgi_path_info 是 /id/1</span>
</span></span><span class="line"><span class="cl">        fastcgi_split_path_info ^<span class="o">(</span>.+<span class="se">\.</span>php<span class="o">)(</span>.*<span class="o">)</span>$<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="c1">#此值即是 PHP 中 $_SERVER[&#39;SCRIPT_FILENAME&#39;] 的值</span>
</span></span><span class="line"><span class="cl">        fastcgi_param   SCRIPT_FILENAME <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        fastcgi_param   PATH_INFO               <span class="nv">$fastcgi_path_info</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        fastcgi_param   PATH_TRANSLATED <span class="nv">$document_root$fastcgi_path_info</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        <span class="c1">#指定FastCGI服务器监听端口与地址。须和 PHP-FPM 的设置相同。</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#fastcgi_pass   127.0.0.1:9000;</span>
</span></span><span class="line"><span class="cl">        fastcgi_pass    unix:/var/run/php5-fpm.sock<span class="p">;</span>
</span></span><span class="line"><span class="cl">        include fastcgi_params<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h2>设置<span class="hx-absolute -hx-mt-20" id="设置"></span>
    <a href="#%e8%ae%be%e7%bd%ae" class="subheading-anchor" aria-label="Permalink for this section"></a></h2><h3>通过分区挂载允许最少特权<span class="hx-absolute -hx-mt-20" id="通过分区挂载允许最少特权"></span>
    <a href="#%e9%80%9a%e8%bf%87%e5%88%86%e5%8c%ba%e6%8c%82%e8%bd%bd%e5%85%81%e8%ae%b8%e6%9c%80%e5%b0%91%e7%89%b9%e6%9d%83" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>服务器上的网页/html/php文件单独分区。例如，新建一个分区/dev/sda5(第一逻辑分区)，并且挂载在/nginx。确保 /nginx是以noexec, nodev and nosetuid的权限挂载。比如，下面是一个/etc/fstab的挂载/nginx的信息：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">LABEL</span><span class="o">=</span>/nginx /nginx ext3 defaults,nosuid,noexec,nodev <span class="m">1</span> <span class="m">2</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>注意：需要使用fdisk和mkfs.ext3命令创建一个新分区。</p>
<h3>配置/etc/sysctl.conf强化Linux安全<span class="hx-absolute -hx-mt-20" id="配置etcsysctlconf强化linux安全"></span>
    <a href="#%e9%85%8d%e7%bd%aeetcsysctlconf%e5%bc%ba%e5%8c%96linux%e5%ae%89%e5%85%a8" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>可以通过编辑/etc/sysctl.conf来控制和配置Linux内核、网络设置。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Avoid a smurf attack</span>
</span></span><span class="line"><span class="cl">net.ipv4.icmp_echo_ignore_broadcasts <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Turn on protection for bad icmp error messages</span>
</span></span><span class="line"><span class="cl">net.ipv4.icmp_ignore_bogus_error_responses <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Turn on syncookies for SYN flood attack protection</span>
</span></span><span class="line"><span class="cl">net.ipv4.tcp_syncookies <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Turn on and log spoofed, source routed, and redirect packets</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.all.log_martians <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.default.log_martians <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># No source routed packets here</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.all.accept_source_route <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.default.accept_source_route <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Turn on reverse path filtering</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.all.rp_filter <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.default.rp_filter <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Make sure no one can alter the routing tables</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.all.accept_redirects <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.default.accept_redirects <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.all.secure_redirects <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.default.secure_redirects <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Don’t act as a router</span>
</span></span><span class="line"><span class="cl">net.ipv4.ip_forward <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.all.send_redirects <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv4.conf.default.send_redirects <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Turn on execshild</span>
</span></span><span class="line"><span class="cl">kernel.exec-shield <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">kernel.randomize_va_space <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Tuen IPv6</span>
</span></span><span class="line"><span class="cl">net.ipv6.conf.default.router_solicitations <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv6.conf.default.accept_ra_rtr_pref <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv6.conf.default.accept_ra_pinfo <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv6.conf.default.accept_ra_defrtr <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv6.conf.default.autoconf <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv6.conf.default.dad_transmits <span class="o">=</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">net.ipv6.conf.default.max_addresses <span class="o">=</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Optimization for port usefor LBs</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Increase system file descriptor limit</span>
</span></span><span class="line"><span class="cl">fs.file-max <span class="o">=</span> <span class="m">65535</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Allow for more PIDs (to reduce rollover problems); may break some programs 32768</span>
</span></span><span class="line"><span class="cl">kernel.pid_max <span class="o">=</span> <span class="m">65536</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Increase system IP port limits</span>
</span></span><span class="line"><span class="cl">net.ipv4.ip_local_port_range <span class="o">=</span> <span class="m">2000</span> <span class="m">65000</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Increase TCP max buffer size setable using setsockopt()</span>
</span></span><span class="line"><span class="cl">net.ipv4.tcp_rmem <span class="o">=</span> <span class="m">4096</span> <span class="m">87380</span> <span class="m">8388608</span>
</span></span><span class="line"><span class="cl">net.ipv4.tcp_wmem <span class="o">=</span> <span class="m">4096</span> <span class="m">87380</span> <span class="m">8388608</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Increase Linux auto tuning TCP buffer limits</span>
</span></span><span class="line"><span class="cl"><span class="c1"># min, default, and max number of bytes to use</span>
</span></span><span class="line"><span class="cl"><span class="c1"># set max to at least 4MB, or higher if you use very high BDP paths</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Tcp Windows etc</span>
</span></span><span class="line"><span class="cl">net.core.rmem_max <span class="o">=</span> <span class="m">8388608</span>
</span></span><span class="line"><span class="cl">net.core.wmem_max <span class="o">=</span> <span class="m">8388608</span>
</span></span><span class="line"><span class="cl">net.core.netdev_max_backlog <span class="o">=</span> <span class="m">5000</span>
</span></span><span class="line"><span class="cl">net.ipv4.tcp_window_scaling <span class="o">=</span> <span class="m">1</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>控制缓冲区溢出攻击<span class="hx-absolute -hx-mt-20" id="控制缓冲区溢出攻击"></span>
    <a href="#%e6%8e%a7%e5%88%b6%e7%bc%93%e5%86%b2%e5%8c%ba%e6%ba%a2%e5%87%ba%e6%94%bb%e5%87%bb" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>编辑nginx.conf，为所有客户端设置缓冲区的大小限制。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##Start: Size Limits &amp; Buffer Overflows ##    //server上下文</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">client_body_buffer_size 1K<span class="p">;</span>
</span></span><span class="line"><span class="cl">client_header_buffer_size 1k<span class="p">;</span>
</span></span><span class="line"><span class="cl">client_max_body_size 1k<span class="p">;</span>
</span></span><span class="line"><span class="cl">large_client_header_buffers <span class="m">2</span> 1k<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##END:Size Limits &amp; Buffer Overflows ##</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>说明</p>
<ol>
<li>client_body_buffer_size 1k-（默认8k或16k）这个指令可以指定连接请求实体的缓冲区大小。如果连接请求超过缓存区指定的值，那么这些请求实体的整体或部分将尝试写入一个临时文件。</li>
<li>client_header_buffer_size 1k-指令指定客户端请求头部的缓冲区大小。绝大多数情况下一个请求头不会大于1k，不过如果有来自于wap客户端的较大的cookie它可能会大于 1k，Nginx将分配给它一个更大的缓冲区，这个值可以在large_client_header_buffers里面设置。</li>
<li>client_max_body_size 1k-指令指定允许客户端连接的最大请求实体大小，它出现在请求头部的Content-Length字段。
如果请求大于指定的值，客户端将收到一个”Request Entity Too Large” (413)错误。记住，浏览器并不知道怎样显示这个错误。</li>
<li>large_client_header_buffers-指定客户端一些比较大的请求头使用的缓冲区数量和大小。请求字段不能大于一个缓冲区大小，如果客户端发送一个比较大的头，nginx将返回”Request URI too large” (414)
同样，请求的头部最长字段不能大于一个缓冲区，否则服务器将返回”Bad request” (400)。缓冲区只在需求时分开。默认一个缓冲区大小为操作系统中分页文件大小，通常是4k或8k，如果一个连接请求最终将状态转换为keep- alive，它所占用的缓冲区将被释放。</li>
</ol>
<p>还需要控制超时来提高服务器性能并与客户端断开连接。按照如下编辑：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">## Start: Timeouts ##</span>
</span></span><span class="line"><span class="cl">client_body_timeout 10<span class="p">;</span>
</span></span><span class="line"><span class="cl">client_header_timeout 10<span class="p">;</span>
</span></span><span class="line"><span class="cl">keepalive_timeout <span class="m">5</span> 5<span class="p">;</span>
</span></span><span class="line"><span class="cl">send_timeout 10<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">## End: Timeouts ##</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>说明</p>
<ol>
<li>client_body_timeout 10;-指令指定读取请求实体的超时时间。这里的超时是指一个请求实体没有进入读取步骤，如果连接超过这个时间而客户端没有任何响应，Nginx将返回一个”Request time out” (408)错误。</li>
<li>client_header_timeout 10;-指令指定读取客户端请求头标题的超时时间。这里的超时是指一个请求头没有进入读取步骤，如果连接超过这个时间而客户端没有任何响应，Nginx将返回一个”Request time out” (408)错误。</li>
<li>keepalive_timeout 5 5; – 参数的第一个值指定了客户端与服务器长连接的超时时间，超过这个时间，服务器将关闭连接。参数的第二个值（可选）指定了应答头中Keep-Alive: timeout=time的time值，这个值可以使一些浏览器知道什么时候关闭连接，以便服务器不用重复关闭，如果不指定这个参数，nginx不会在应 答头中发送Keep-Alive信息。（但这并不是指怎样将一个连接“Keep-Alive”）参数的这两个值可以不相同。</li>
<li>send_timeout 10; 指令指定了发送给客户端应答后的超时时间，Timeout是指没有进入完整established状态，只完成了两次握手，如果超过这个时间客户端没有任何响应，nginx将关闭连接</li>
</ol>
<h3>控制并发连接<span class="hx-absolute -hx-mt-20" id="控制并发连接"></span>
    <a href="#%e6%8e%a7%e5%88%b6%e5%b9%b6%e5%8f%91%e8%bf%9e%e6%8e%a5" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>可以使用NginxHttpLimitZone模块来限制指定的会话或者一个IP地址的特殊情况下的并发连接。</p>
<p>编辑nginx.conf, 每个远程IP地址的客户端同时打开连接不能超过5个:</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">### Directive describes the zone,in which the session states are stored i.e. stored in slimits. ###</span>
</span></span><span class="line"><span class="cl"><span class="c1">### 1m can handle 32000 sessions with 32 bytes/session,set to 5m x 32000 session###</span>
</span></span><span class="line"><span class="cl">limit_conn_zone <span class="nv">$binary_remote_addr</span> <span class="nv">zone</span><span class="o">=</span>slimits:5m<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### Control maximum number of simultaneous connections for one session i.e.###</span>
</span></span><span class="line"><span class="cl"><span class="c1">### restricts the amount of connections from a single ip address ###</span>
</span></span><span class="line"><span class="cl">limit_conn slimits 5<span class="p">;</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>只允许域名的访问<span class="hx-absolute -hx-mt-20" id="只允许域名的访问"></span>
    <a href="#%e5%8f%aa%e5%85%81%e8%ae%b8%e5%9f%9f%e5%90%8d%e7%9a%84%e8%ae%bf%e9%97%ae" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>可以逃过ip扫描</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">## Only requests to our Host are allowed i.e. xxx.in,images.xxx.in and www.xxx.in</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="o">(</span><span class="nv">$host</span> !~ ^<span class="o">(</span>xxx.in<span class="p">|</span>www.xxx.in<span class="p">|</span>images.xxx.in<span class="o">)</span>$<span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 444 = Connection closed without response</span>
</span></span><span class="line"><span class="cl">    retrun 444<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>或者</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span> <span class="nv">$host</span> !~* <span class="s1">&#39;abc.com&#39;</span> <span class="o">)</span> <span class="o">{</span>  
</span></span><span class="line"><span class="cl">    <span class="k">return</span> 403<span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="o">}</span>  </span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>url 参数过滤敏感字<span class="hx-absolute -hx-mt-20" id="url-参数过滤敏感字"></span>
    <a href="#url-%e5%8f%82%e6%95%b0%e8%bf%87%e6%bb%a4%e6%95%8f%e6%84%9f%e5%ad%97" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="nv">$query_string</span> ~* <span class="s2">&#34;union.*select.*\(&#34;</span><span class="o">)</span> <span class="o">{</span>   
</span></span><span class="line"><span class="cl">    rewrite ^/<span class="o">(</span>.*<span class="o">)</span>$  <span class="nv">$host</span>  permanent<span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="o">}</span>   
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="nv">$query_string</span> ~* <span class="s2">&#34;concat.*\(&#34;</span><span class="o">)</span> <span class="o">{</span>   
</span></span><span class="line"><span class="cl">    rewrite ^/<span class="o">(</span>.*<span class="o">)</span>$  <span class="nv">$host</span>  permanent<span class="p">;</span>  
</span></span><span class="line"><span class="cl"><span class="o">}</span>  </span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>限制可用的请求方法<span class="hx-absolute -hx-mt-20" id="限制可用的请求方法"></span>
    <a href="#%e9%99%90%e5%88%b6%e5%8f%af%e7%94%a8%e7%9a%84%e8%af%b7%e6%b1%82%e6%96%b9%e6%b3%95" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>下面的指令将过滤只允许GET,HEAD和POST方法：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##Only allow these request methods##</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span><span class="o">(</span><span class="nv">$request_method</span> !~ ^<span class="o">(</span>GET<span class="p">|</span>HEAD<span class="p">|</span>POST<span class="o">)</span>$<span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    retrun 444<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>拒绝一些User-Agents<span class="hx-absolute -hx-mt-20" id="拒绝一些user-agents"></span>
    <a href="#%e6%8b%92%e7%bb%9d%e4%b8%80%e4%ba%9buser-agents" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">##Block download agents ##</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="nv">$http_user_agent</span> ~* LWP::Simple<span class="p">|</span>BBBike<span class="p">|</span>wget<span class="o">){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">retrun 403<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">##Block some robots ##</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 阻止Soso和有道的机器人：</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="nv">$http_user_agent</span> ~* Sosospider<span class="p">|</span>Yodaobot<span class="o">){</span>
</span></span><span class="line"><span class="cl">    retrun 403<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>为了更好的维护，最好创建一个文件，包含不期望的user agent列表。例如/etc/nginx/blockuseragents.rules包含如下内容：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">map <span class="nv">$http_user_agent</span> <span class="nv">$blockedagent</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    default 0<span class="p">;</span>
</span></span><span class="line"><span class="cl">    ~*malicious 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">    ~*bot 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">    ~*backdoor 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">    ~*crawler 1<span class="p">;</span>
</span></span><span class="line"><span class="cl">    ~*bandit 1<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>然后将如下语句放入配置文件的server模块内,并加入if语句设置阻止后进入的页面：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">include /etc/nginx/blockuseragents.rules<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">server <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="nv">$blockedagent</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> 403<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    listen  192.168.0.12:8080<span class="p">;</span>
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>目录限制IP访问<span class="hx-absolute -hx-mt-20" id="目录限制ip访问"></span>
    <a href="#%e7%9b%ae%e5%bd%95%e9%99%90%e5%88%b6ip%e8%ae%bf%e9%97%ae" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>可以对指定的目录设置访问权限。所有的网站目录应该一一配置，只允许必须的目录访问权限。</p>
<p>可以通过IP地址来限制访问目录/admin/:</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">location /docs/ <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">##block one workstation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  deny 192.168.1.1<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">## allow anyone in 192.168.1.0/24</span>
</span></span><span class="line"><span class="cl">  allow 192.168.1.0/24<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">##drop rest of the world</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  deny all<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>更多的时候客户端请求会经过层层代理，我们需要通过$http_x_forwarded_for来进行限制，可以这样写：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">set</span> <span class="nv">$allow</span> false<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="nv">$http_x_forwarded_for</span> <span class="o">=</span> <span class="s2">&#34;211.144.204.2&#34;</span><span class="o">)</span> <span class="o">{</span> <span class="nb">set</span> <span class="nv">$allow</span> true<span class="p">;</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="nv">$http_x_forwarded_for</span> ~ <span class="s2">&#34;108.2.66.[89]&#34;</span><span class="o">)</span> <span class="o">{</span> <span class="nb">set</span> <span class="nv">$allow</span> true<span class="p">;</span> <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">(</span><span class="nv">$allow</span> <span class="o">=</span> <span class="nb">false</span><span class="o">)</span> <span class="o">{</span> <span class="k">return</span> 404<span class="p">;</span> <span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>通过密码保护目录<span class="hx-absolute -hx-mt-20" id="通过密码保护目录"></span>
    <a href="#%e9%80%9a%e8%bf%87%e5%af%86%e7%a0%81%e4%bf%9d%e6%8a%a4%e7%9b%ae%e5%bd%95" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>首先创建密码文件并增加“user”用户：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mkdir /usr/local/nginx/conf/.htpasswd/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">htpasswd -c /usr/local/nginx/conf/.htpasswd/passwd user</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>编辑nginx.conf,加入需要保护的目录：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">###Password Protect /personal-images/ and /delta/ directories###</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">location ~ /<span class="o">(</span>personal-images/./delta/.<span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    auth_basic <span class="s2">&#34;Restricted&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    auth_basic_user_file /usr/local/nginx/conf/.htpasswd/passwd<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>密码文件生成后，也可以用以下的命令来增加允许访问的用户：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">htpasswd -s /usr/local/nginx/conf/.htpasswd/passwd userName</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>如何防止图片盗链<span class="hx-absolute -hx-mt-20" id="如何防止图片盗链"></span>
    <a href="#%e5%a6%82%e4%bd%95%e9%98%b2%e6%ad%a2%e5%9b%be%e7%89%87%e7%9b%97%e9%93%be" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>如果有人直接用你网站的图片地址来显示在他的网站上，会造成你需要支付额外的宽带费用。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># Stop deep linking or hot linking</span>
</span></span><span class="line"><span class="cl">location /images/ <span class="o">{</span>
</span></span><span class="line"><span class="cl">    valid_referers none blocked www.example.com example.com<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="nv">$invalid_referer</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> 403<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>重定向并显示指定图片</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">location /images/ <span class="o">{</span>
</span></span><span class="line"><span class="cl">    valid_referers blocked www.example.com example.com<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">(</span><span class="nv">$invalid_referer</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        rewrite ^/images/uploads.*.<span class="o">(</span>gif<span class="p">|</span>jpg<span class="p">|</span>jpeg<span class="p">|</span>png<span class="o">)</span>$ http://www.examples.com/banned.jpg last
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>Nginx SSL配置<span class="hx-absolute -hx-mt-20" id="nginx-ssl配置"></span>
    <a href="#nginx-ssl%e9%85%8d%e7%bd%ae" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>编辑nginx.conf并更新：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">server<span class="o">{</span>
</span></span><span class="line"><span class="cl">    server_name example.com<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    listen 443<span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ssl on<span class="p">;</span>
</span></span><span class="line"><span class="cl">    ssl_certificate /user/local/nginx/conf/server.crt<span class="p">;</span>
</span></span><span class="line"><span class="cl">    ssl_certificate_key /usr/local/nginx/conf/server.key<span class="p">;</span>
</span></span><span class="line"><span class="cl">    access_log /usr/local/nginx/logs/ssl.access.log<span class="p">;</span>
</span></span><span class="line"><span class="cl">    error_log /usr/local/nginx/logs/ssl.error.log<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>在防火墙级限制每个IP的连接数<span class="hx-absolute -hx-mt-20" id="在防火墙级限制每个ip的连接数"></span>
    <a href="#%e5%9c%a8%e9%98%b2%e7%81%ab%e5%a2%99%e7%ba%a7%e9%99%90%e5%88%b6%e6%af%8f%e4%b8%aaip%e7%9a%84%e8%bf%9e%e6%8e%a5%e6%95%b0" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>网络服务器必须监视连接和每秒连接限制。PF和Iptales都能够在进入你的nginx服务器之前阻止最终用户的访问。
Linux Iptables:限制每次Nginx连接数</p>
<p>下面的例子会阻止来自一个IP的60秒钟内超过15个连接端口80的连接数。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/sbin/iptables -A INPUT -p tcp –dport <span class="m">80</span> -i eth0 -m state –state NEW -m recent –set
</span></span><span class="line"><span class="cl">/sbin/iptables -A INPUT -p tcp –dport <span class="m">80</span> -i eth0 -m state –state NEW -m recent –update –seconds <span class="m">60</span> –hitcount <span class="m">15</span> -j DROP
</span></span><span class="line"><span class="cl">service iptables save</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>请根据具体情况来设置限制的连接数。</p>
<h3>配置操作系统保护Web服务器<span class="hx-absolute -hx-mt-20" id="配置操作系统保护web服务器"></span>
    <a href="#%e9%85%8d%e7%bd%ae%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f%e4%bf%9d%e6%8a%a4web%e6%9c%8d%e5%8a%a1%e5%99%a8" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>Nginx以用户nginx运行。但是根目录（/nginx或者/usr /local/nginx/html）不应该设置属于用户nginx或对用户nginx可写。</p>
<p>找出错误权限的文件可以使用如下命令：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">find /nginx -user nginx
</span></span><span class="line"><span class="cl">find /usr/local/nginx/html -user nginx</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>确保你更所有权为root或其它用户，一个典型的权限设置 /usr/local/nginx/html/</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ls -l /usr/local/nginx/html/</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>示例输出：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">-rw-r–r– <span class="m">1</span> root root <span class="m">925</span> Jan <span class="m">3</span> 00:50 error4xx.html
</span></span><span class="line"><span class="cl">-rw-r–r– <span class="m">1</span> root root <span class="m">52</span> Jan <span class="m">3</span> 10:00 error5xx.html
</span></span><span class="line"><span class="cl">-rw-r–r– <span class="m">1</span> root root <span class="m">134</span> Jan <span class="m">3</span> 00:52 index.html</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>你必须删除由vi或其它文本编辑器创建的备份文件：</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">find /nginx -name ‘.?’ -not -name .ht -or -name ‘~’ -or -name ‘.bak’ -or -name ‘.old*’
</span></span><span class="line"><span class="cl">find /usr/local/nginx/html/ -name ‘.?’ -not -name .ht -or -name ‘~’ -or -name ‘.bak’ -or -name ‘.old*’</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>通过find命令的-delete选项来删除这些文件。</p>
<h3>限制Nginx连接传出<span class="hx-absolute -hx-mt-20" id="限制nginx连接传出"></span>
    <a href="#%e9%99%90%e5%88%b6nginx%e8%bf%9e%e6%8e%a5%e4%bc%a0%e5%87%ba" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>黑客会使用工具如wget下载你服务器本地的文件。使用Iptables从nginx用户来阻止传出连接。ipt_owner模块试图匹配本地产生的数据包的创建者。下面的例子中只允许user用户在外面使用80连接。</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/sbin/iptables -A OUTPUT -o eth0 -m owner –uid-owner vivek -p tcp –dport <span class="m">80</span> -m state –state NEW,ESTABLISHED -j ACCEPT</span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>根据用户的真实 IP 做连接限制<span class="hx-absolute -hx-mt-20" id="根据用户的真实-ip-做连接限制"></span>
    <a href="#%e6%a0%b9%e6%8d%ae%e7%94%a8%e6%88%b7%e7%9a%84%e7%9c%9f%e5%ae%9e-ip-%e5%81%9a%e8%bf%9e%e6%8e%a5%e9%99%90%e5%88%b6" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">## 这里取得原始用户的IP地址</span>
</span></span><span class="line"><span class="cl">map <span class="nv">$http_x_forwarded_for</span>  <span class="nv">$clientRealIp</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;</span>  <span class="nv">$remote_addr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    ~^<span class="o">(</span>?P&lt;firstAddr&gt;<span class="o">[</span>0-9<span class="se">\.</span><span class="o">]</span>+<span class="o">)</span>,?.*$    <span class="nv">$firstAddr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">## 针对原始用户 IP 地址做限制</span>
</span></span><span class="line"><span class="cl">limit_conn_zone <span class="nv">$clientRealIp</span> <span class="nv">zone</span><span class="o">=</span>TotalConnLimitZone:20m <span class="p">;</span>
</span></span><span class="line"><span class="cl">limit_conn  TotalConnLimitZone  50<span class="p">;</span>
</span></span><span class="line"><span class="cl">limit_conn_log_level notice<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">## 针对原始用户 IP 地址做限制</span>
</span></span><span class="line"><span class="cl">limit_req_zone <span class="nv">$clientRealIp</span> <span class="nv">zone</span><span class="o">=</span>ConnLimitZone:20m  <span class="nv">rate</span><span class="o">=</span>10r/s<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#limit_req zone=ConnLimitZone burst=10 nodelay;</span>
</span></span><span class="line"><span class="cl">limit_req_log_level notice<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="c1">## 具体服务器配置</span>
</span></span><span class="line"><span class="cl">server <span class="o">{</span>
</span></span><span class="line"><span class="cl">    listen   80<span class="p">;</span>
</span></span><span class="line"><span class="cl">    location ~ <span class="se">\.</span>php$ <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">## 最多 5 个排队， 由于每秒处理 10 个请求 + 5个排队，你一秒最多发送 15 个请求过来，再多就直接返回 503 错误给你了</span>
</span></span><span class="line"><span class="cl">        limit_req <span class="nv">zone</span><span class="o">=</span>ConnLimitZone <span class="nv">burst</span><span class="o">=</span><span class="m">5</span> nodelay<span class="p">;</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">        fastcgi_pass   127.0.0.1:9000<span class="p">;</span>
</span></span><span class="line"><span class="cl">        fastcgi_index  index.php<span class="p">;</span>
</span></span><span class="line"><span class="cl">        include fastcgi_params<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>  
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>经过多层CDN之后取得原始用户的IP地址<span class="hx-absolute -hx-mt-20" id="经过多层cdn之后取得原始用户的ip地址"></span>
    <a href="#%e7%bb%8f%e8%bf%87%e5%a4%9a%e5%b1%82cdn%e4%b9%8b%e5%90%8e%e5%8f%96%e5%be%97%e5%8e%9f%e5%a7%8b%e7%94%a8%e6%88%b7%e7%9a%84ip%e5%9c%b0%e5%9d%80" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>通过 map 指令，我们为 nginx 创建了一个变量 $clientRealIp ，这个就是 原始用户的真实 IP 地址，不论用户是直接访问，还是通过一串 CDN 之后的访问，我们都能取得正确的原始IP地址</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">map <span class="nv">$http_x_forwarded_for</span>  <span class="nv">$clientRealIp</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">## 没有通过代理，直接用 remote_addr</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;</span>  <span class="nv">$remote_addr</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">        <span class="c1">## 用正则匹配，从 x_forwarded_for 中取得用户的原始IP</span>
</span></span><span class="line"><span class="cl">        <span class="c1">## 例如   X-Forwarded-For: 202.123.123.11, 208.22.22.234, 192.168.2.100,...</span>
</span></span><span class="line"><span class="cl">        <span class="c1">## 这里第一个 202.123.123.11 是用户的真实 IP，后面其它都是经过的 CDN 服务器</span>
</span></span><span class="line"><span class="cl">    ~^<span class="o">(</span>?P&lt;firstAddr&gt;<span class="o">[</span>0-9<span class="se">\.</span><span class="o">]</span>+<span class="o">)</span>,?.*$    <span class="nv">$firstAddr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>隐藏版本信息<span class="hx-absolute -hx-mt-20" id="隐藏版本信息"></span>
    <a href="#%e9%9a%90%e8%97%8f%e7%89%88%e6%9c%ac%e4%bf%a1%e6%81%af" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">server_tokens   off<span class="p">;</span>
</span></span><span class="line"><span class="cl">proxy_hide_header        X-Powered-By<span class="p">;</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>禁用扩展名<span class="hx-absolute -hx-mt-20" id="禁用扩展名"></span>
    <a href="#%e7%a6%81%e7%94%a8%e6%89%a9%e5%b1%95%e5%90%8d" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">location ~* .<span class="o">(</span>txt<span class="p">|</span>doc<span class="p">|</span>sql<span class="p">|</span>gz<span class="p">|</span>svn<span class="p">|</span>git<span class="o">)</span>$ <span class="o">{</span>
</span></span><span class="line"><span class="cl">   deny all<span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>重定向HTTP请求到HTTPS<span class="hx-absolute -hx-mt-20" id="重定向http请求到https"></span>
    <a href="#%e9%87%8d%e5%ae%9a%e5%90%91http%e8%af%b7%e6%b1%82%e5%88%b0https" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">server <span class="o">{</span>
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="m">301</span>  https://<span class="nv">$server_name$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    ...
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<h3>防止XSS攻击<span class="hx-absolute -hx-mt-20" id="防止xss攻击"></span>
    <a href="#%e9%98%b2%e6%ad%a2xss%e6%94%bb%e5%87%bb" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">add_header X-Frame-Options <span class="s2">&#34;SAMEORIGIN&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">add_header X-XSS-Protection <span class="s2">&#34;1; mode=block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">add_header X-Content-Type-Options <span class="s2">&#34;nosniff&#34;</span><span class="p">;</span></span></span></code></pre></div></div><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<ul>
<li><code>X-Frame-Options</code>： 响应头表示是否允许浏览器加载frame等属性，有三个配置DENY禁止任何网页被嵌入,SAMEORIGIN`只允许本网站的嵌套,ALLOW-FROM允许指定地址的嵌套</li>
<li><code>X-XSS-Protection</code>： 表示启用XSS过滤（禁用过滤为X-XSS-Protection: 0），mode=block表示若检查到XSS攻击则停止渲染页面</li>
<li><code>X-Content-Type-Options</code>： 响应头用来指定浏览器对未指定或错误指定Content-Type资源真正类型的猜测行为，nosniff 表示不允许任何猜测</li>
</ul>
<p>在通常的请求响应中，浏览器会根据Content-Type来分辨响应的类型，但当响应类型未指定或错误指定时，浏览会尝试启用MIME-sniffing来猜测资源的响应类型，这是非常危险的</p>
<p>例如一个.jpg的图片文件被恶意嵌入了可执行的js代码，在开启资源类型猜测的情况下，浏览器将执行嵌入的js代码，可能会有意想不到的后果</p>
<h3>目录只读<span class="hx-absolute -hx-mt-20" id="目录只读"></span>
    <a href="#%e7%9b%ae%e5%bd%95%e5%8f%aa%e8%af%bb" class="subheading-anchor" aria-label="Permalink for this section"></a></h3><p>如果没有上传需求，完全可以把网站根目录弄成只读的，加固安全。</p>
<p>做了一点小动作，给网站根目录搞了一个只读的挂载点。这里假设网站根目录为/var/www/html</p>
<div class="hextra-code-block hx-relative hx-mt-6 first:hx-mt-0 hx-group/code">
  

<pre><code>mkdir -p /data  
mkdir -p /var/www/html  
mount --bind /data /var/www/html  
mount -o remount,ro --bind /data /var/www/html  </code></pre><div class="hextra-code-copy-btn-container hx-opacity-0 hx-transition group-hover/code:hx-opacity-100 hx-flex hx-gap-1 hx-absolute hx-m-[11px] hx-right-0 hx-top-0">
  <button
    class="hextra-code-copy-btn hx-group/copybtn hx-transition-all active:hx-opacity-50 hx-bg-primary-700/5 hx-border hx-border-black/5 hx-text-gray-600 hover:hx-text-gray-900 hx-rounded-md hx-p-1.5 dark:hx-bg-primary-300/10 dark:hx-border-white/10 dark:hx-text-gray-400 dark:hover:hx-text-gray-50"
    title="Copy code"
  >
    <div class="copy-icon group-[.copied]/copybtn:hx-hidden hx-pointer-events-none hx-h-4 hx-w-4"></div>
    <div class="success-icon hx-hidden group-[.copied]/copybtn:hx-block hx-pointer-events-none hx-h-4 hx-w-4"></div>
  </button>
</div>

  
</div>
<p>网站内容实际位于/data，网站内容更新就往/data里更新，目录/var/www/html无法执行任何写操作，否则会报错“Read-only file system”，极大程度上可以防止提权篡改。</p>
<hr>
<p>参考链接：</p>
<ul>
<li><a href="https://www.cnblogs.com/RiwellAckerman/p/11273705.html" target="_blank" rel="noopener">https://www.cnblogs.com/RiwellAckerman/p/11273705.html</a></li>
<li><a href="https://www.hack520.com/456.html" target="_blank" rel="noopener">https://www.hack520.com/456.html</a></li>
<li><a href="https://www.cnblogs.com/chenpingzhao/p/5785416.html" target="_blank" rel="noopener">https://www.cnblogs.com/chenpingzhao/p/5785416.html</a></li>
<li><a href="https://blog.csdn.net/qidakui_123/article/details/106036299" target="_blank" rel="noopener">https://blog.csdn.net/qidakui_123/article/details/106036299</a></li>
<li><a href="https://blog.51cto.com/hobowizard/1895269" target="_blank" rel="noopener">https://blog.51cto.com/hobowizard/1895269</a></li>
</ul>

        </div>
        
    <div class="hx-mt-12 hx-mb-8 hx-block hx-text-xs hx-text-gray-500 ltr:hx-text-right rtl:hx-text-left dark:hx-text-gray-400">最后更新于 <time datetime="2024-11-30T18:58:28.000Z">November 30, 2024</time></div>
        
        <div class="hx-mb-8 hx-flex hx-items-center hx-border-t hx-pt-8 dark:hx-border-neutral-800 contrast-more:hx-border-neutral-400 dark:contrast-more:hx-border-neutral-400 print:hx-hidden"><a
        href="/blog/2020/11/es_max_map_count_error/"
        title="Elastic Search vm.max_map_count too low 错误"
        class="hx-flex hx-max-w-[50%] hx-items-center hx-gap-1 hx-py-4 hx-text-base hx-font-medium hx-text-gray-600 hx-transition-colors [word-break:break-word] hover:hx-text-primary-600 dark:hx-text-gray-300 md:hx-text-lg ltr:hx-pr-4 rtl:hx-pl-4"
      ><svg class="hx-inline hx-h-5 hx-shrink-0 ltr:hx-rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg>Elastic Search vm.max_map_count too low 错误</a><a
        href="/blog/2020/12/k8s_container_tech_intro/"
        title="Kubernetes in Action笔记 - (1) 容器技术介绍"
        class="hx-flex hx-max-w-[50%] hx-items-center hx-gap-1 hx-py-4 hx-text-base hx-font-medium hx-text-gray-600 hx-transition-colors [word-break:break-word] hover:hx-text-primary-600 dark:hx-text-gray-300 md:hx-text-lg ltr:hx-ml-auto ltr:hx-pl-4 ltr:hx-text-right rtl:hx-mr-auto rtl:hx-pr-4 rtl:hx-text-left"
      >Kubernetes in Action笔记 - (1) 容器技术介绍<svg class="hx-inline hx-h-5 hx-shrink-0 rtl:-hx-rotate-180" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/></svg></a></div>
        
      </main>
    </article>
  </div>

      <footer class="hextra-footer hx-bg-gray-100 hx-pb-[env(safe-area-inset-bottom)] dark:hx-bg-neutral-900 print:hx-bg-transparent"><div class="hx-mx-auto hx-flex hx-gap-2 hx-py-2 hx-px-4 hx-max-w-screen-xl"><button
  title="切换主题"
  data-theme="light"
  class="theme-toggle hx-group hx-h-7 hx-rounded-md hx-px-2 hx-text-left hx-text-xs hx-font-medium hx-text-gray-600 hx-transition-colors dark:hx-text-gray-400 hover:hx-bg-gray-100 hover:hx-text-gray-900 dark:hover:hx-bg-primary-100/5 dark:hover:hx-text-gray-50"
  type="button"
  aria-label="切换主题"
>
  <div class="hx-flex hx-items-center hx-gap-2 hx-capitalize"><svg height=12 class="group-data-[theme=light]:hx-hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/></svg><span class="group-data-[theme=light]:hx-hidden">浅色</span><svg height=12 class="group-data-[theme=dark]:hx-hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg><span class="group-data-[theme=dark]:hx-hidden">深色</span></div>
</button>
</div><hr class="dark:hx-border-neutral-800" /><div
    class="hx-max-w-screen-xl hx-mx-auto hx-flex hx-justify-center hx-py-12 hx-pl-[max(env(safe-area-inset-left),1.5rem)] hx-pr-[max(env(safe-area-inset-right),1.5rem)] hx-text-gray-600 dark:hx-text-gray-400 md:hx-justify-start"
  >
    <div class="hx-flex hx-w-full hx-flex-col hx-items-center sm:hx-items-start"><div class="hx-mt-6 hx-text-xs"><img class="favicon" src="/favicon-32x32.png">Copyright © 2018 - 2025 保罗札记. All Rights Reserved</div>
    </div>
  </div>
</footer>
    
    <script defer src="/js/main.js" integrity=""></script>


<script defer src="/lib/flexsearch/flexsearch.bundle.min.0425860527cc9968f9f049421c7a56b39327d475e2e3a8f550416be3a9134327.js" integrity="sha256-BCWGBSfMmWj58ElCHHpWs5Mn1HXi46j1UEFr46kTQyc="></script>
    <script defer src="/zh-cn.search.js" integrity=""></script>


  </body>
</html>
